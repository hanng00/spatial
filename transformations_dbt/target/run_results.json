{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.13", "generated_at": "2025-10-10T12:23:55.810984Z", "invocation_id": "b36d26c2-f9e4-449c-85be-7aa5178814db", "invocation_started_at": "2025-10-10T12:23:36.915358Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T12:23:40.507380Z", "completed_at": "2025-10-10T12:23:40.537000Z"}, {"name": "execute", "started_at": "2025-10-10T12:23:40.539468Z", "completed_at": "2025-10-10T12:23:41.877060Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 1.4157581329345703, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.riksbevakning.stg_personlista", "compiled": true, "compiled_code": "-- Staging model for personlista (members)\n-- Cleans and standardizes the raw data from riksdagen API\n\nselect\n    -- Add all relevant columns from personlista\n    -- This is a placeholder - adjust based on actual schema\n    *\nfrom \"raw\".\"riksdagen\".\"personlista\"", "relation_name": "\"analytics\".\"main_stg\".\"stg_personlista\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T12:23:40.479963Z", "completed_at": "2025-10-10T12:23:40.509915Z"}, {"name": "execute", "started_at": "2025-10-10T12:23:40.510874Z", "completed_at": "2025-10-10T12:23:41.877842Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.4177391529083252, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.riksbevakning.stg_anforandelista", "compiled": true, "compiled_code": "-- Staging model for anforandelista (speeches)\n-- Cleans and standardizes the raw data from riksdagen API\n\nselect\n    systemnyckel,\n    dok_datum,\n    dok_rm as rm,\n    dok_id,\n    dok_titel,\n    anforande_id,\n    anforande_nummer,\n    talare,\n    parti,\n    anforandetext as anforande_text,\n    intressent_id,\n    -- Add any cleaning/standardization here\n    trim(upper(parti)) as parti_clean,\n    case \n        when dok_datum is not null then dok_datum\n        else '1900-01-01'\n    end as dok_datum_clean,\n    -- Additional fields\n    avsnittsrubrik,\n    underrubrik,\n    kammaraktivitet,\n    replik,\n    systemdatum\nfrom \"raw\".\"riksdagen\".\"anforandelista\"", "relation_name": "\"analytics\".\"main_stg\".\"stg_anforandelista\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T12:23:40.489055Z", "completed_at": "2025-10-10T12:23:40.510305Z"}, {"name": "execute", "started_at": "2025-10-10T12:23:40.535351Z", "completed_at": "2025-10-10T12:23:41.878701Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 1.4175071716308594, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.riksbevakning.stg_dokumentlista", "compiled": true, "compiled_code": "-- Staging model for dokumentlista (documents)\n-- Cleans and standardizes the raw data from riksdagen API\n\nselect\n    -- Add all relevant columns from dokumentlista\n    -- This is a placeholder - adjust based on actual schema\n    *\nfrom \"raw\".\"riksdagen\".\"dokumentlista\"", "relation_name": "\"analytics\".\"main_stg\".\"stg_dokumentlista\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T12:23:40.498322Z", "completed_at": "2025-10-10T12:23:40.510654Z"}, {"name": "execute", "started_at": "2025-10-10T12:23:40.537352Z", "completed_at": "2025-10-10T12:23:42.991031Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 2.528839349746704, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.riksbevakning.stg_document_touchpoints", "compiled": true, "compiled_code": "-- Staging model for document touchpoints\n-- Extracts politician involvement in documents\n\nwith document_intressent as (\n    select\n        dok_id,\n        datum as document_date,\n        titel as document_title,\n        doktyp as document_type,\n        parti as party,\n        efternamn as last_name,\n        tilltalsnamn as first_name,\n        valkrets as electoral_district,\n        -- Extract intressent_id from nested JSON\n        json_extract_string(dokintressent__intressent, '$.intressent_id') as intressent_id,\n        json_extract_string(dokintressent__intressent, '$.roll') as role,\n        json_extract_string(dokintressent__intressent, '$.ordning') as order_rank,\n        _dlt_load_id,\n        _dlt_id\n    from \"raw\".\"riksdagen\".\"dokumentlista\"\n    where dokintressent__intressent is not null\n)\n\nselect\n    dok_id,\n    document_date,\n    document_title,\n    document_type,\n    intressent_id,\n    role,\n    order_rank,\n    party,\n    last_name,\n    first_name,\n    electoral_district,\n    'document' as touchpoint_type,\n    'authored' as touchpoint_category,\n    _dlt_load_id,\n    _dlt_id\nfrom document_intressent\nwhere intressent_id is not null", "relation_name": "\"analytics\".\"main_stg\".\"stg_document_touchpoints\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T12:23:41.890911Z", "completed_at": "2025-10-10T12:23:41.896871Z"}, {"name": "execute", "started_at": "2025-10-10T12:23:41.897334Z", "completed_at": "2025-10-10T12:23:42.991737Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 1.105726957321167, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.riksbevakning.stg_voteringlista", "compiled": true, "compiled_code": "-- Staging model for voteringlista (voting records)\n-- Cleans and standardizes the raw data from riksdagen API\n\nselect\n    -- Add all relevant columns from voteringlista\n    -- This is a placeholder - adjust based on actual schema\n    *\nfrom \"raw\".\"riksdagen\".\"voteringlista\"", "relation_name": "\"analytics\".\"main_stg\".\"stg_voteringlista\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T12:23:41.889086Z", "completed_at": "2025-10-10T12:23:41.894990Z"}, {"name": "execute", "started_at": "2025-10-10T12:23:41.895287Z", "completed_at": "2025-10-10T12:23:44.183285Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.2984580993652344, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.riksbevakning.stg_speech_touchpoints", "compiled": true, "compiled_code": "-- Staging model for speech touchpoints\n-- Extracts politician speeches from anforandelista\n\nselect\n    systemnyckel as speech_id,\n    dok_datum as speech_date,\n    dok_id as document_id,\n    dok_titel as document_title,\n    anforande_id as speech_number,\n    anforande_nummer as speech_order,\n    talare as speaker_name,\n    parti as party,\n    anforandetext as speech_text,\n    dok_rm as parliamentary_session,\n    intressent_id, -- Direct from source now!\n    'speech' as touchpoint_type,\n    'spoken' as touchpoint_category,\n    length(anforandetext) as speech_length_chars,\n    avsnittsrubrik as section_title,\n    underrubrik as subsection_title,\n    kammaraktivitet as chamber_activity,\n    replik as reply_type,\n    systemdatum as speech_timestamp,\n    _dlt_load_id,\n    _dlt_id\nfrom \"raw\".\"riksdagen\".\"anforandelista\"\nwhere talare is not null and intressent_id is not null", "relation_name": "\"analytics\".\"main_stg\".\"stg_speech_touchpoints\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T12:23:42.996809Z", "completed_at": "2025-10-10T12:23:42.999415Z"}, {"name": "execute", "started_at": "2025-10-10T12:23:43.001166Z", "completed_at": "2025-10-10T12:23:44.183928Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 1.1895461082458496, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.riksbevakning.int_speeches_by_party", "compiled": true, "compiled_code": "-- Intermediate model: Speeches aggregated by party\n-- Combines staging data to create analytics-ready aggregations\n\nselect\n    parti_clean as party,\n    count(*) as speech_count,\n    count(distinct dok_datum) as days_with_speeches,\n    min(dok_datum_clean) as first_speech_date,\n    max(dok_datum_clean) as last_speech_date\nfrom \"analytics\".\"main_stg\".\"stg_anforandelista\"\nwhere parti_clean is not null\ngroup by parti_clean\norder by speech_count desc", "relation_name": "\"analytics\".\"main_int\".\"int_speeches_by_party\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T12:23:41.886900Z", "completed_at": "2025-10-10T12:23:41.892458Z"}, {"name": "execute", "started_at": "2025-10-10T12:23:41.892781Z", "completed_at": "2025-10-10T12:23:44.419110Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 2.533928155899048, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.riksbevakning.stg_politicians", "compiled": true, "compiled_code": "-- Staging model for politicians (personlista)\n-- Creates clean politician master data\n\nselect\n    intressent_id,\n    hangar_id,\n    tilltalsnamn as first_name,\n    efternamn as last_name,\n    sorteringsnamn as display_name,\n    parti as party,\n    valkrets as electoral_district,\n    iort as birthplace,\n    fodd_ar as birth_year,\n    kon as gender,\n    status as member_status,\n    -- Extract nested data\n    personuppdrag as assignments_raw,\n    personuppgift as personal_info_raw,\n    -- Clean party name\n    trim(upper(parti)) as party_clean,\n    -- Create full name\n    concat(tilltalsnamn, ' ', efternamn) as full_name,\n    -- Add metadata\n    _dlt_load_id,\n    _dlt_id\nfrom \"raw\".\"riksdagen\".\"personlista\"\nwhere intressent_id is not null", "relation_name": "\"analytics\".\"main_stg\".\"stg_politicians\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T12:23:42.995419Z", "completed_at": "2025-10-10T12:23:42.999141Z"}, {"name": "execute", "started_at": "2025-10-10T12:23:42.999623Z", "completed_at": "2025-10-10T12:23:44.978251Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 1.984785795211792, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.riksbevakning.stg_voting_touchpoints", "compiled": true, "compiled_code": "-- Staging model for voting touchpoints\n-- Extracts politician voting records\n\nselect\n    votering_id,\n    intressent_id,\n    namn as full_name,\n    fornamn as first_name,\n    efternamn as last_name,\n    parti as party,\n    valkrets as electoral_district,\n    iort as birthplace,\n    kon as gender,\n    fodd as birth_year,\n    rost as vote_choice,\n    avser as vote_subject,\n    votering as vote_description,\n    dok_id as document_id,\n    beteckning as document_reference,\n    punkt as document_point,\n    rm as parliamentary_session,\n    systemdatum as vote_timestamp,\n    'vote' as touchpoint_type,\n    'voted' as touchpoint_category,\n    _dlt_load_id,\n    _dlt_id\nfrom \"raw\".\"riksdagen\".\"voteringlista\"\nwhere intressent_id is not null", "relation_name": "\"analytics\".\"main_stg\".\"stg_voting_touchpoints\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T12:23:44.188686Z", "completed_at": "2025-10-10T12:23:44.192317Z"}, {"name": "execute", "started_at": "2025-10-10T12:23:44.192641Z", "completed_at": "2025-10-10T12:23:45.262404Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 1.0759022235870361, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.riksbevakning.mart_party_performance", "compiled": true, "compiled_code": "-- Mart model: Party performance metrics\n-- Final dataset for party analysis and reporting\n\nselect\n    party,\n    speech_count,\n    days_with_speeches,\n    first_speech_date,\n    last_speech_date,\n    -- Calculate derived metrics\n    round(speech_count::float / days_with_speeches, 2) as avg_speeches_per_day,\n    case \n        when last_speech_date::date > current_date - interval '30 days' then 'Active'\n        else 'Inactive'\n    end as activity_status\nfrom \"analytics\".\"main_int\".\"int_speeches_by_party\"\norder by speech_count desc", "relation_name": "\"analytics\".\"main_mart\".\"mart_party_performance\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T12:23:44.187270Z", "completed_at": "2025-10-10T12:23:44.190445Z"}, {"name": "execute", "started_at": "2025-10-10T12:23:44.190889Z", "completed_at": "2025-10-10T12:23:45.261728Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.0764460563659668, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.riksbevakning.mart_daily_speech_summary", "compiled": true, "compiled_code": "-- Mart model: Daily speech summary for consumption\n-- Final dataset ready for dashboards and analysis\n\nselect\n    dok_datum_clean as speech_date,\n    count(*) as total_speeches,\n    count(distinct parti_clean) as parties_active,\n    count(distinct dok_id) as unique_documents,\n    count(distinct rm) as parliamentary_sessions\nfrom \"analytics\".\"main_stg\".\"stg_anforandelista\"\nwhere dok_datum_clean is not null\ngroup by dok_datum_clean\norder by dok_datum_clean desc", "relation_name": "\"analytics\".\"main_mart\".\"mart_daily_speech_summary\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T12:23:44.981483Z", "completed_at": "2025-10-10T12:23:44.983759Z"}, {"name": "execute", "started_at": "2025-10-10T12:23:44.983931Z", "completed_at": "2025-10-10T12:23:50.686586Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 5.706222057342529, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.riksbevakning.int_politician_touchpoints", "compiled": true, "compiled_code": "-- Intermediate model: Unified politician touchpoints\n-- Combines all touchpoint types with direct intressent_id matching\n\nwith all_touchpoints as (\n    -- Document touchpoints\n    select\n        intressent_id,\n        dok_id as touchpoint_id,\n        document_date as touchpoint_date,\n        document_title as touchpoint_title,\n        touchpoint_type,\n        touchpoint_category,\n        party,\n        first_name,\n        last_name,\n        electoral_district,\n        role as touchpoint_detail,\n        null as parliamentary_session,\n        null as vote_choice,\n        null as speech_length_chars\n    from \"analytics\".\"main_stg\".\"stg_document_touchpoints\"\n    \n    union all\n    \n    -- Speech touchpoints (now with direct intressent_id)\n    select\n        intressent_id,\n        speech_id as touchpoint_id,\n        speech_date as touchpoint_date,\n        document_title as touchpoint_title,\n        touchpoint_type,\n        touchpoint_category,\n        party,\n        null as first_name,\n        null as last_name,\n        null as electoral_district,\n        speech_order as touchpoint_detail,\n        parliamentary_session,\n        null as vote_choice,\n        speech_length_chars\n    from \"analytics\".\"main_stg\".\"stg_speech_touchpoints\"\n    \n    union all\n    \n    -- Voting touchpoints\n    select\n        intressent_id,\n        votering_id as touchpoint_id,\n        vote_timestamp::date as touchpoint_date,\n        vote_description as touchpoint_title,\n        touchpoint_type,\n        touchpoint_category,\n        party,\n        first_name,\n        last_name,\n        electoral_district,\n        vote_subject as touchpoint_detail,\n        parliamentary_session,\n        vote_choice,\n        null as speech_length_chars\n    from \"analytics\".\"main_stg\".\"stg_voting_touchpoints\"\n)\n\nselect\n    intressent_id,\n    touchpoint_id,\n    touchpoint_date,\n    touchpoint_title,\n    touchpoint_type,\n    touchpoint_category,\n    party,\n    first_name,\n    last_name,\n    electoral_district,\n    touchpoint_detail,\n    parliamentary_session,\n    vote_choice,\n    speech_length_chars,\n    -- Add derived fields\n    extract(year from touchpoint_date::date) as touchpoint_year,\n    extract(month from touchpoint_date::date) as touchpoint_month,\n    case \n        when touchpoint_type = 'vote' then 'Voting'\n        when touchpoint_type = 'speech' then 'Speaking'\n        when touchpoint_type = 'document' then 'Document'\n        else 'Other'\n    end as touchpoint_type_label\nfrom all_touchpoints\nwhere intressent_id is not null\norder by intressent_id, touchpoint_date desc", "relation_name": "\"analytics\".\"main_int\".\"int_politician_touchpoints\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T12:23:50.693461Z", "completed_at": "2025-10-10T12:23:50.701944Z"}, {"name": "execute", "started_at": "2025-10-10T12:23:50.702527Z", "completed_at": "2025-10-10T12:23:55.802632Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 5.11055588722229, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.riksbevakning.mart_politician360", "compiled": true, "compiled_code": "-- Mart model: Politician360 - Complete politician touchpoint view\n-- Final dataset for politician analysis and reporting\n\nwith politician_summary as (\n    select\n        p.intressent_id,\n        p.display_name,\n        p.full_name,\n        p.party_clean as party,\n        p.electoral_district,\n        p.birth_year,\n        p.gender,\n        p.member_status,\n        -- Touchpoint counts\n        count(t.touchpoint_id) as total_touchpoints,\n        count(case when t.touchpoint_type = 'vote' then 1 end) as total_votes,\n        count(case when t.touchpoint_type = 'speech' then 1 end) as total_speeches,\n        count(case when t.touchpoint_type = 'document' then 1 end) as total_documents,\n        -- Date ranges\n        min(t.touchpoint_date) as first_touchpoint_date,\n        max(t.touchpoint_date) as last_touchpoint_date,\n        -- Activity metrics\n        count(distinct t.touchpoint_date) as active_days,\n        count(distinct t.parliamentary_session) as parliamentary_sessions_active,\n        -- Voting patterns\n        count(case when t.vote_choice = 'Ja' then 1 end) as yes_votes,\n        count(case when t.vote_choice = 'Nej' then 1 end) as no_votes,\n        count(case when t.vote_choice = 'Avst\u00e5r' then 1 end) as abstained_votes,\n        -- Speech metrics\n        avg(t.speech_length_chars) as avg_speech_length,\n        sum(t.speech_length_chars) as total_speech_chars\n    from \"analytics\".\"main_stg\".\"stg_politicians\" p\n    left join \"analytics\".\"main_int\".\"int_politician_touchpoints\" t\n        on p.intressent_id = t.intressent_id\n    group by \n        p.intressent_id, p.display_name, p.full_name, p.party_clean, \n        p.electoral_district, p.birth_year, p.gender, p.member_status\n),\n\npolitician_timeline as (\n    select\n        intressent_id,\n        touchpoint_date,\n        touchpoint_type,\n        touchpoint_title,\n        touchpoint_detail,\n        parliamentary_session,\n        vote_choice,\n        row_number() over (\n            partition by intressent_id \n            order by touchpoint_date desc, touchpoint_id\n        ) as touchpoint_rank\n    from \"analytics\".\"main_int\".\"int_politician_touchpoints\"\n),\n\nrecent_activity as (\n    select\n        intressent_id,\n        string_agg(\n            touchpoint_type || ': ' || substr(touchpoint_title, 1, 50) || '...',\n            ' | '\n        ) as recent_touchpoints\n    from politician_timeline\n    where touchpoint_rank <= 5\n    group by intressent_id\n)\n\nselect\n    s.*,\n    -- Derived metrics\n    case \n        when s.total_votes > 0 then \n            round(s.yes_votes::float / s.total_votes * 100, 1)\n        else null \n    end as yes_vote_percentage,\n    \n    case \n        when s.total_touchpoints > 0 then \n            round(s.total_touchpoints::float / s.active_days, 1)\n        else 0 \n    end as avg_touchpoints_per_day,\n    \n    case \n        when s.birth_year is not null and s.birth_year != '' and s.birth_year ~ '^[0-9]{4}$' then \n            extract(year from current_date) - s.birth_year::int\n        else null \n    end as current_age,\n    \n    -- Activity status\n    case \n        when s.last_touchpoint_date::date > current_date - interval '30 days' then 'Very Active'\n        when s.last_touchpoint_date::date > current_date - interval '90 days' then 'Active'\n        when s.last_touchpoint_date::date > current_date - interval '365 days' then 'Less Active'\n        else 'Inactive'\n    end as activity_status,\n    \n    -- Recent activity summary\n    r.recent_touchpoints,\n    \n    -- Metadata\n    current_timestamp as created_at\n\nfrom politician_summary s\nleft join recent_activity r\n    on s.intressent_id = r.intressent_id\norder by s.total_touchpoints desc, s.display_name", "relation_name": "\"analytics\".\"main_mart\".\"mart_politician360\"", "batch_results": null}], "elapsed_time": 17.762233018875122, "args": {"require_batched_execution_for_custom_microbatch_strategy": false, "log_path": "/Users/hannes/Developer/SIDEPROJECTS/riksbevakning/dataplatform/dbt/logs", "write_json": true, "send_anonymous_usage_stats": true, "require_explicit_package_overrides_for_builtin_materializations": true, "printer_width": 80, "use_colors": true, "warn_error_options": {"error": [], "warn": [], "silence": []}, "empty": false, "log_level_file": "debug", "source_freshness_run_project_hooks": true, "use_colors_file": true, "require_resource_names_without_spaces": true, "indirect_selection": "eager", "print": true, "select": ["stg+"], "quiet": false, "require_generic_test_arguments_property": true, "require_yaml_configuration_for_mf_time_spines": false, "state_modified_compare_vars": false, "exclude": [], "partial_parse_file_diff": true, "validate_macro_args": false, "log_format_file": "debug", "vars": {}, "cache_selected_only": false, "strict_mode": false, "invocation_command": "dbt run --select stg+ --profiles-dir /Users/hannes/Developer/SIDEPROJECTS/riksbevakning/dataplatform/dbt", "log_file_max_bytes": 10485760, "populate_cache": true, "version_check": true, "defer": false, "partial_parse": true, "introspect": true, "log_format": "default", "require_all_warnings_handled_by_warn_error": false, "macro_debugging": false, "static_parser": true, "use_fast_test_edges": false, "favor_state": false, "show_resource_report": false, "upload_to_artifacts_ingest_api": false, "profiles_dir": "/Users/hannes/Developer/SIDEPROJECTS/riksbevakning/dataplatform/dbt", "which": "run", "state_modified_compare_more_unrendered_values": false, "log_level": "info", "project_dir": "/Users/hannes/Developer/SIDEPROJECTS/riksbevakning/dataplatform/dbt", "show_all_deprecations": false, "require_nested_cumulative_type_params": false, "skip_nodes_if_on_run_start_fails": false}}